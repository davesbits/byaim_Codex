<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Crawler | byAIm</title>
      <link rel="stylesheet" href="styles.css" />
      <style>
            .crawler-results {
                  margin-top: 2rem;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 12px;
                  padding: 1.5rem;
                  border: 1px solid rgba(255, 255, 255, 0.1);
                  display: none;
            }

            .crawler-results.visible {
                  display: block;
            }

            .result-item {
                  margin-bottom: 1rem;
                  padding-bottom: 1rem;
                  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .result-item:last-child {
                  border-bottom: none;
            }

            .result-label {
                  font-size: 0.75rem;
                  text-transform: uppercase;
                  color: var(--text-muted);
                  margin-bottom: 0.25rem;
            }

            .result-value {
                  font-size: 0.95rem;
                  color: var(--text-main);
                  word-break: break-all;
            }

            .loading-spinner {
                  display: inline-block;
                  width: 1rem;
                  height: 1rem;
                  border: 2px solid rgba(255, 255, 255, 0.3);
                  border-radius: 50%;
                  border-top-color: #fff;
                  animation: spin 1s ease-in-out infinite;
                  margin-right: 0.5rem;
            }

            @keyframes spin {
                  to {
                        transform: rotate(360deg);
                  }
            }
      </style>
</head>

<body>
      <div class="bg-slideshow home-bg">
            <div class="bg-slide bg-1"></div>
            <div class="bg-slide bg-2"></div>
            <div class="bg-slide bg-3"></div>
            <div class="bg-slide bg-4"></div>
      </div>
      <div class="bg-overlay"></div>
      <div class="bg-veil"></div>

      <div class="site-shell">
            <header>
                  <div class="header-inner">
                        <div class="brand">
                              <div class="brand-mark"></div>
                              <div class="brand-text">by<span>AIm</span></div>
                        </div>
                        <nav>
                              <a href="index.html" class="nav-link">Home</a>
                              <a href="members.html" class="nav-link">Members</a>
                              <a href="business.html" class="nav-link">Business</a>
                              <a href="charities.html" class="nav-link">Charities</a>
                              <a href="support.html" class="nav-link">Support</a>
                              <a href="crawler.html" class="nav-link nav-link--active">Crawler</a>
                              <a href="login.html" class="nav-link nav-link--primary">Login</a>
                        </nav>
                  </div>
            </header>

            <main>
                  <div class="page-shell">
                        <div class="hero-shell">
                              <div class="hero-content">
                                    <div class="hero-kicker">Data Ingestion</div>
                                    <h1 class="hero-title">URL <span class="hero-title-strong">Crawler</span></h1>
                                    <p class="hero-subtitle">
                                          Input a URL below to extract content and metadata. This tool uses our edge
                                          network to securely fetch and analyze web pages.
                                    </p>

                                    <div class="card">
                                          <form id="crawler-form" class="contact-grid"
                                                style="grid-template-columns: 1fr; gap: 1rem;">
                                                <div class="form-group">
                                                      <label class="form-label" for="url-input">Target URL</label>
                                                      <input type="url" id="url-input" class="form-input"
                                                            placeholder="https://example.com" required />
                                                </div>
                                                <button type="submit" class="btn btn--primary" id="crawl-btn">
                                                      <span>Start Crawl</span>
                                                </button>
                                          </form>

                                          <div id="results-area" class="crawler-results">
                                                <h3 class="section-subheading">Results</h3>
                                                <div id="results-content"></div>
                                          </div>
                                    </div>
                              </div>

                              <div class="hero-side">
                                    <div class="panel">
                                          <div class="panel-title">Capabilities</div>
                                          <h3 class="panel-heading">Edge Extraction</h3>
                                          <p class="panel-text">
                                                Powered by Cloudflare Workers, our crawler fetches content with low
                                                latency and high reliability.
                                          </p>
                                          <ul class="checklist">
                                                <li>HTML Content Extraction</li>
                                                <li>Metadata Analysis</li>
                                                <li>Secure Proxying</li>
                                          </ul>
                                    </div>
                              </div>
                        </div>
                  </div>
            </main>

            <footer>
                  <div class="footer-inner">
                        <div>&copy; 2025 byAIm Inc.</div>
                        <div class="launch-tag">System Status: Operational</div>
                  </div>
            </footer>
      </div>

      <script>
            const form = document.getElementById('crawler-form');
            const input = document.getElementById('url-input');
            const btn = document.getElementById('crawl-btn');
            const resultsArea = document.getElementById('results-area');
            const resultsContent = document.getElementById('results-content');

            form.addEventListener('submit', async (e) => {
                  e.preventDefault();
                  const url = input.value;
                  if (!url) return;

                  // Reset UI
                  btn.disabled = true;
                  btn.innerHTML = '<span class="loading-spinner"></span> Processing...';
                  resultsArea.classList.remove('visible');
                  resultsContent.innerHTML = '';

                  try {
                        const response = await fetch('/api/crawler', {
                              method: 'POST',
                              headers: { 'Content-Type': 'application/json' },
                              body: JSON.stringify({ url })
                        });

                        const data = await response.json();

                        if (!response.ok) {
                              throw new Error(data.message || `Error ${response.status}: ${response.statusText}`);
                        }

                        // Display results
                        resultsContent.innerHTML = `
          <div class="result-item">
            <div class="result-label">Status</div>
            <div class="result-value" style="color: #4ade80">${data.status} OK</div>
          </div>
          <div class="result-item">
            <div class="result-label">Content Length</div>
            <div class="result-value">${data.length} bytes</div>
          </div>
          <div class="result-item">
            <div class="result-label">Preview</div>
            <div class="result-value" style="font-family: monospace; white-space: pre-wrap; font-size: 0.85rem; opacity: 0.9;">${escapeHtml(data.content_preview)}...</div>
          </div>
        `;
                        resultsArea.classList.add('visible');

                  } catch (err) {
                        resultsContent.innerHTML = `
          <div class="result-item">
            <div class="result-label">Error</div>
            <div class="result-value" style="color: #ff8f8f">${err.message}</div>
          </div>
        `;
                        resultsArea.classList.add('visible');
                  } finally {
                        btn.disabled = false;
                        btn.innerHTML = '<span>Start Crawl</span>';
                  }
            });

            function escapeHtml(text) {
                  if (!text) return '';
                  return text
                        .replace(/&/g, "&amp;")
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/"/g, "&quot;")
                        .replace(/'/g, "&#039;");
            }
      </script>
</body>

</html>